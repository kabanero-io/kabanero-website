language: ruby
rvm:
  - 2.6.3

install:
  - bundle install
  - npm install eslint --save-dev
  - ./node_modules/.bin/eslint src/main/content/_assets/js/*.js

script: >
    if [ $JEKYLL_ENV == "production" ]; then
      cp robots.txt src/main/content/robots.txt      
      ./scripts/build_jekyll_maven.sh
    else
      ./scripts/build_jekyll_maven.sh
    fi

sudo: false

before_deploy: 
 - curl -fsSL https://clis.cloud.ibm.com/install/linux | sh

deploy:
  provider: script
  skip_cleanup: true
  on:
    tags: true
  script: "./scripts/ibmcloud-cf-push.sh kabanero-prod"