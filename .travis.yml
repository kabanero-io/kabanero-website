language: minimal
env:
  global:
  - secure: TPuDnQEV5CeqWZ+M4QN5Si53KZE4IgtjzFUhDG9ZNDqn3px8/N2qvM9AruiSiDrRSR83bQpIBnrrhGlY2ISptSqlhFbKZ96yaMP+XMGXIf5OCvKMR82N/kro7sB4DFGZqa7BIcs1ErofR60KHnWil2Neaa6MFRxSYTk1XmPNSHWGHOXM0RsweOTMTb4sy1fuySLiZPRIh7a7/t1VrtHlzbbMhwTszaAZQMXZiyESmEuc8PKmFY2QI8KD131Rfqa5YZALUzBJDZknsqOn7s5uGBUCQ2KAte1ZbMnEUan2eUkyUbr2mwmuWcwSMk9Gz44cL71VnTlGf5gdpJyH94fcEpChS+/ifvoz31iQ2BWVYiuLhn53CqEzm+Vn08gBTNinVspI3wC53hCIFsofeJvZo6sn0Hl0VcG232hpptMozSIH2IUGVNKw099J79paEfKri6F9riHYsPpdtZP37aOxYKSY62ZMAixHec/T9QzK4dU7gL0RM5z1MB7I36e1QBtesjqHo5YsKUDc8ybVnccYerYj9uj0rtWaCneG746NltcgYTfXD541d8P3woplkTWM3e7Y/JIIDzNTgeul5nkjRZx6iaMEzBXHv5zVPv8oF/uJjKD18jVMTjKUxJLNwMJJ1HkSFwij+916zVAaW5ZLY8QCACbEa7flKuL7R7jSLsw=

before_install:
- docker pull  kabanerobuild/website-travis:latest
install:
- docker build --cache-from  kabanerobuild/website-travis:latest -t website-travis
  -f travis/Dockerfile .
stages:
- name: Running tests
  if: "(type IN (pull_request))"
- name: Deploy
  if: type IN (api)
jobs:
  include:
  - stage: Running tests
    name: Running lint testing and building website with Jekyll
    script:
    - ./travis/docker_run.sh "./node_modules/.bin/eslint src/main/content/_assets/js/*.js"
    - ./travis/docker_run.sh "./scripts/build_jekyll_maven.sh PAT=$PAT"
  - stage: Deploy
    name: Deploy website
    script:
    - "./travis/docker_run.sh ./travis/travis_ibmcloud_cf_push.sh"
