language: minimal

cache:
  directories:
    - docker-cache

before_install:
  - |
    filename=docker-cache/saved_images.tar
    if [[ -f "$filename" ]]; then docker load < "$filename"; fi
    mkdir -p docker-cache
    docker pull kidus60/travis-testing
    docker save -o "$filename" kidus60/travis-testing

install:
  - docker build --cache-from kidus60/travis-testing -t travis-testing -f travis/Dockerfile .

stages:
  - name: Running tests
    if: type IN (push)
  - name: Deploy
    if: type IN (push)

jobs:
  include:
    - stage: "Running tests"
      name: "Running lint testing and building website with Jekyll"
      script:
        - ./travis/docker_run.sh "./node_modules/.bin/eslint src/main/content/_assets/js/*.js"
        - ./travis/docker_run.sh ./scripts/build_jekyll_maven.sh
    - stage: "Deploy"
      name: "Deploy website"
      script: 
        -  ./travis/docker_run.sh ./travis/travis_ibmcloud_cf_push.sh
