language: ruby
rvm:
  - 2.6.3

install:
  - bundle install
  - npm install eslint --save-dev
  - ./node_modules/.bin/eslint src/main/content/_assets/js/*.js

script: 
 - echo $TRAVIS_REPO_SLUG[0]
 - ./scripts/build_jekyll_maven.sh
 - echo ${TRAVIS_REPO_SLUG[0]}

sudo: false

before_deploy: 
 - curl -fsSL https://clis.cloud.ibm.com/install/linux | sh

deploy:
  - provider: script
    skip_cleanup: true
    on:
     tags: true
    script: "./scripts/ibmcloud-cf-push.sh kabanero-prod"
  - provider: script
    skip_cleanup: true
    on:
      repo: $TRAVIS_REPO_SLUG
      branch: $TRAVIS_BRANCH
      condition: "$TRAVIS_EVENT_TYPE = api"
    script: "./scripts/ibmcloud-cf-push.sh kabanero-cf-deploy"
